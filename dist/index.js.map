{"version":3,"sources":["../src/index.js"],"names":["PORT","app","server","http","createServer","use","exposedHeaders","bodyParser","json","limit","wss","Server","clients","on","connection","userId","length","newClient","ws","push","console","log","message","filter","client","get","req","res","version","next","people","setInterval","forEach","msg","send","listen","process","env","address","port"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAIA,IAAMA,OAAO,IAAb;AACA,IAAMC,MAAM,wBAAZ;AACAA,IAAIC,MAAJ,GAAaC,eAAKC,YAAL,CAAkBH,GAAlB,CAAb;;AAGAA,IAAII,GAAJ,CAAQ,sBAAO,KAAP,CAAR;;AAGAJ,IAAII,GAAJ,CAAQ,oBAAK;AACTC,iBAAgB;AADP,CAAL,CAAR;;AAIAL,IAAII,GAAJ,CAAQE,qBAAWC,IAAX,CAAgB;AACpBC,QAAO;AADa,CAAhB,CAAR;;AASAR,IAAIS,GAAJ,GAAU,IAAIC,WAAJ,CAAW;AACpBT,SAAQD,IAAIC;AADQ,CAAX,CAAV;;AAMA,IAAIU,UAAU,EAAd;;AAGAX,IAAIS,GAAJ,CAAQG,EAAR,CAAW,YAAX,EAAyB,UAACC,UAAD,EAAgB;;AAKxC,KAAMC,SAASH,QAAQI,MAAR,GAAiB,CAAhC;;AAIAF,YAAWC,MAAX,GAAoBA,MAApB;;AAGA,KAAME,YAAY;AACjBC,MAAIJ,UADa;AAEjBC,UAAQA;AAFS,EAAlB;;AAMAH,SAAQO,IAAR,CAAaF,SAAb;;AAEAG,SAAQC,GAAR,CAAY,mCAAZ,EAAiDN,MAAjD;;AAGAD,YAAWD,EAAX,CAAc,SAAd,EAAyB,UAACS,OAAD,EAAa;;AAGrCF,UAAQC,GAAR,CAAY,eAAZ,EAA6BC,OAA7B;AAGA,EAND;;AAUAR,YAAWD,EAAX,CAAc,OAAd,EAAuB,YAAM;;AAE5BO,UAAQC,GAAR,CAAY,iBAAZ,EAA+BN,MAA/B,EAAuC,kBAAvC;;AAGAH,YAAUA,QAAQW,MAAR,CAAe,UAACC,MAAD;AAAA,UAAYA,OAAOT,MAAP,KAAkBA,MAA9B;AAAA,GAAf,CAAV;AAEA,EAPD;AASA,CA1CD;;AA6CAd,IAAIwB,GAAJ,CAAQ,GAAR,EAAY,UAACC,GAAD,EAAMC,GAAN,EAAc;;AAEzBA,KAAInB,IAAJ,CAAS;AACRoB,WAAUA;AADF,EAAT;AAIA,CAND;;AAQA3B,IAAIwB,GAAJ,CAAQ,sBAAR,EAAgC,UAACC,GAAD,EAAMC,GAAN,EAAWE,IAAX,EAAoB;;AAGnD,QAAOF,IAAInB,IAAJ,CAAS;;AAEfsB,UAAQlB;AAFO,EAAT,CAAP;AAKA,CARD;;AAYAmB,YAAY,YAAM;;AAGjB;;AAEAX,SAAQC,GAAR,YAAqBT,QAAQI,MAA7B;;AAGA,KAAGJ,QAAQI,MAAR,GAAkB,CAArB,EAAuB;;AAEtBJ,UAAQoB,OAAR,CAAgB,UAACR,MAAD,EAAY;;AAE3B;;AAEA,OAAMS,mBAAiBT,OAAOT,MAAxB,wCAAN;;AAEAS,UAAON,EAAP,CAAUgB,IAAV,CAAeD,GAAf;AAEA,GARD;AASA;AAGD,CAtBD,EAsBG,IAtBH;;AAwBAhC,IAAIC,MAAJ,CAAWiC,MAAX,CAAkBC,QAAQC,GAAR,CAAYrC,IAAZ,IAAoBA,IAAtC,EAA4C,YAAM;AAC1CoB,SAAQC,GAAR,6BAAsCpB,IAAIC,MAAJ,CAAWoC,OAAX,GAAqBC,IAA3D;AACP,CAFD;;kBAIetC,G","file":"index.js","sourcesContent":["import http from 'http';\r\nimport express from 'express';\r\nimport cors from 'cors';\r\nimport morgan from 'morgan';\r\nimport bodyParser from 'body-parser';\r\nimport {version} from '../package.json'\r\nimport WebSocketServer, {Server} from 'uws';\r\n\r\n\r\n\r\nconst PORT = 3000;\r\nconst app = express();\r\napp.server = http.createServer(app);\r\n\r\n\r\napp.use(morgan('dev'));\r\n\r\n\r\napp.use(cors({\r\n    exposedHeaders: \"*\"\r\n}));\r\n\r\napp.use(bodyParser.json({\r\n    limit: '50mb'\r\n}));\r\n\r\n\r\n\r\n\r\n\r\n\r\napp.wss = new Server({\r\n\tserver: app.server\r\n});\r\n\r\n\r\n\r\nlet clients = [];\r\n\r\n\r\napp.wss.on('connection', (connection) => {\r\n\r\n\r\n\t\r\n\r\n\tconst userId = clients.length + 1;\r\n\r\n\t\r\n\r\n\tconnection.userId = userId;\r\n\r\n\r\n\tconst newClient = {\r\n\t\tws: connection,\r\n\t\tuserId: userId,\r\n\t};\r\n\r\n\r\n\tclients.push(newClient);\r\n\r\n\tconsole.log(\"New client connected with userId:\", userId);\r\n\r\n\r\n\tconnection.on('message', (message) => {\r\n\r\n\r\n\t\tconsole.log(\"message from:\", message);\r\n\r\n\r\n\t});\r\n\r\n\r\n\r\n\tconnection.on('close', () => {\r\n\r\n\t\tconsole.log(\"client with ID \", userId, ' is disconnected');\r\n\r\n\r\n\t\tclients = clients.filter((client) => client.userId !== userId);\r\n\r\n\t});\r\n\r\n});\r\n\r\n\r\napp.get('/',(req, res) => {\r\n\r\n\tres.json({\r\n\t\tversion:  version\r\n\t});\r\n\r\n});\r\n\r\napp.get('/api/all_connections', (req, res, next) => {\r\n\r\n\r\n\treturn res.json({\r\n\r\n\t\tpeople: clients,\r\n\t});\r\n\r\n});\r\n\r\n\r\n\r\nsetInterval(() => {\r\n\r\n\r\n\t// each 3 seconds this function will be executed.\r\n\r\n\tconsole.log(`There ${clients.length} people in the connection.`);\r\n\r\n\r\n\tif(clients.length  > 0){\r\n\r\n\t\tclients.forEach((client) => {\r\n\r\n\t\t\t//console.log(\"CLient ID\", client.userId);\r\n\r\n\t\t\tconst msg = `Hey ID: ${client.userId}: you got a new message from server`;\r\n\r\n\t\t\tclient.ws.send(msg);\r\n\r\n\t\t});\r\n\t}\r\n\r\n\r\n}, 3000)\r\n\r\napp.server.listen(process.env.PORT || PORT, () => {\r\n        console.log(`App is running on port ${app.server.address().port}`);\r\n});\r\n\r\nexport default app;"]}